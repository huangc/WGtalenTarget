##-------------------------------------------
## Identify the RVD from TALEN.fa directly, instead of using the RVDs from literature search.
# Translate the pTALEN.fa nucleotide seq into pTALEN.pep protein seq using EMBOSS::transeq
transeq -sequence pTALEN.fa -outseq pTALEN.translate
# Identify the Tandem repeat patterns. Note that the tandem repaeats are composed of 34 residues that look like "LTPDQVVAIASHDGGKQALETVQRLLPVLCQDHG", \
mostly starts with LTP and ends with DHG, with the RVD at the position 12-13, such as HD in the above case.
# So find the repeat patterns with sed, add newline sign and clean up to identify the tandem repeats
sed -e 's/LTP/\nLTP/g' pTALEN.translate > pTALEN.TandemRepeats
# Retrieve the RVDs with cut
cut -c 12-13 pTALEN.TandemRepeats > pTALEN.RVD
# Finally replace the newline signs with space. Note that sed would not work easily on this case, so use tr instead
tr '\n' ' ' < pTALEN.RVD > pTALEN.RVD2

## Tandem Repeats
>Ubi1-TALEN-L-pTALEN-Os11N3-LR_1
LTPAQVVAIASHDGGKQALETVQRLLPVLCQDHG
LTPDQVVAIASNGGGKQALETVQRLLPVLCQAHG
LTPAQVVAIASNGGGKQALETVQRLLPVLCQDHG
LTQDQVVAIASHDGGKQALETVQRLLPVLCQDHG
LTPDQVVAIASHDGGKQALETVQRLLPVLCQDHG
LTPDQVVAIASNGGGKQALETVQRLLPVLCQDHG
LTPDQVVAIASNGGGKQALETVQRLLPVLCQDHG
LTQDQVVAIASHDGGKQALETLQRLLPVLCQDHG
LTPDQVVAIASHDGGKQALETVQRLLPVLCQAHG
LTPAQVVAIASNGGGKQALETVQRLLPVLCQDHG
LTPDQVVAIASNIGGKQALETVQRLLPVLCQDHG
LTPDQVVAIANNNGGKQALETVQRLLPVLCQGHG
LTQDQVVAIASHDGGKQALETVQRLLPVLCQDHG
LTPDQVVAIASNIGGKQALETVQRLLPVLCQDHG
LTPDQVVAIASHDGGKQALETVQRLLPVLCQDHG
LTPDQVVAIASNGGGKQALETVQRLLPVLCQDHG
LTPDQVVAIASNIGGKQALETVQRLLPVLCQDHG
LTPDQVVAIASNGGGKQALETVQRLLPVLCQDHG
LTPDQVVAIASNIGGKQALETVQRLLPVLCQDHG
LTPDQVVAIASNGGGKQALETVQRLLPVLCQDHG
LTPDQVVAIASNIGGKQALETVQRLLPVLCQDHG
LTPDQVVAIASNIGGKQALETIVAQLSRPDPALAALTND

>CaMV_35S-TALEN-R-pTALEN-Os11N3-LR_1
LTPAQVVAIANNNGGKQALETVQRLLPVLCQDHG
LTQDQVVAIASHDGGKQALETVQRLLPVLCQAHG
LTPAQVVAIASNGGGKQALETVQRLLPVLCQDHG
LTPDQVVAIASNGGGKQALETVQRLLPVLCQDHG
LTPDQVVAIANNNGGKQALETVQRLLPVLCQDHG
LTPDQVVAIASNIGGKQALETVQRLLPVLCQDHG
LTPDQVVAIASNIGGKQALETVQRLLPVLCQDHG
LTPDQVVAIANNNGGKQALETLQRLLPVLCQDHG
LTPDQVVAIANNNGGKQALETVQRLLPVLCQDHG
LTPDQVVAIASHDGGKQALETVQRLLPVLCQDHG
LTPDQVVAIASNGGGKQALETVQRLLPVLCQDHG
LTPDQVVAIASNGGGKQALETVQRLLPVLCQDHG
LTPDQVVAIANNNGGKQALETVQRLLPVLCQDHG
LTPDQVVAIASNIGGKQALETVQRLLPVLCQDHG
LTPDQVVAIASNGGGKQALETVQRLLPVLCQDHG
LTPDQVVAIANNNGGKQALETVQRLLPVLCQDHG
LTPDQVVAIASNIGGKQALETVQRLLPVLCQDHG
LTPDQVVAIANNNGGKQALETVQRLLPVLCQDHG
LTQDQVVAIASHDGGKQALETVQRLLPVLCQDHG
LTPDQVVATASNGGGKQALETVQRLLPVLCQDHG
LTPDQVVAIASNGGGKQALETVQRLLPVLCQDHG
LTPDQVVAIASNIGGKQALETIVAQLSRPDPALAALTND

>Ubi1-TALEN-L-pTALEN-8N3-LR_1
LTPDQVVAIASNGGGKQALETVQRLLPVLCQDHG
LTPDQVVAIASNIGGKQALETVQRLLPVLCQDHG
LTPDQVVAIANNNGGKQALETVQRLLPVLCQDHG
LTPDQVVAIASNIGGKQALETVQRLLPVLCQAHG
LTPDQVVAIASNGGGKQAVETVQRLLPVLCQDHG
LTPDQVVAIASNIGGKQAVETVQRLLPVLCQAHG
LTPAQVVAIASNGGGKQAVETVQRLLPVLCQDHG
LTPDQVVAIANNNGGKQAVETVQRLLPVLCQDHG
LTPDQVVAIASHDGGKQALETLQRLLPVLCQDHG
LTPDQVVAIASNIGGKQALETVQRLLPVLCQAHG
LTPAQVVAIASNGGGKQALETVQRLLPVLCQDHG
LTPDQVVAIASHDGGKQALETVQRLLPVLCQAHG
LTPAQVVAIASNGGGKQALETVQRLLPVLCQDHG
LTPDQVVAIASHDGGKQAVETVQRLLPVLCQDHG
LTPDQVVAIASHDGGKQAVETVQRLLPVLCQDHG
LTPDQVVAIASHDGGKQAVETVQRLLPVLCQDHG
LTPNQVVAIASNGGKQALESIVAQLSRPDPALAALTND

>CaMV_35S-TALEN-R-pTALEN-8N3-LR_1
LTPDQVVAIASNIGGKQALETVQRLLPVLCQAHG
LTPAQVVAIASNGGGKQALETVQRLLPVLCQDHG
LTPDQVVAIASNIGGKQALETVQRLLPVLCQAHG
LTPAQVVAIASNGGGKQALETVQRLLPVLCQDHG
LTPDQVVAIASNIGGKQAVETVQRLLPVLCQDHG
LTPDQVVAIANNNGGKQAVETVQRLLPVLCQAHG
LTPAQVVAIASNGGGKQAVETVQRLLPVLCQAHG
LTPDQVVAIASNGGGKQALETLQRLLPVLCQDHG
LTPDQVVAIANNNGGKQALETVQRLLPVLCQDHG
LTPDQVVAIANNNGGKQALETVQRLLPVLCQDHG
LTPDQVVAIASNIGGKQALETVQRLLPVLCQDHG
LTPDQVVAIANNNGGKQALETVQRLLPVLCQDHG
LTPDQVVAIASNIGGKQAVETVQRLLPVLCQDHG
LTPDQVVAIASHDGGKQAVETVQRLLPVLCQDHG
LTPDQVVAIASHDGGKQAVETVQRLLPVLCQDHG
LTPDQVVAIASHDGGKQALETVQRLLPVLCQAHG
LTPDQVVAIASNGGGKQALETVQRLLPVLCQDHG
LTPDQVVAIASHDGGKQALETVQRLLPVLCQDHG
LTPDQVVAIASHDGGKQALETVQRLLPVLCQDHG
LTPDQVVAIASNIGGKQALETVQRLLPVLCQDHG
LTPDQVVAIASHDGGKQAVETVQRLLPVLCQAHG
LTPAQVVAIASNGGGKQAVETVQRLLPVLCQDHG
LTPNQVVAIASNGGKQALESIVAQLSRPDPALAALTND


## RVD Results of TALENs
TALEN_L_Os11N3="HD NG NG HD HD NG NG HD HD NG NI NN HD NI HD NG NI NG NI NG NI NI"
TALEN_R_Os11N3="NN HD NG NG NN NI NI NN NN HD NG NG NN NI NG NN NI NN HD NG NG NI"
TALEN_L_Os8N3="NG NI NN NI NG NI NG NN HD NI NG HD NG HD HD HD NG"
TALEN_R_Os8N3="NI NG NI NG NI NN NG NG NN NN NI NN NI HD HD HD NG HD HD NI HD NG NG"

## RVD of AvrXa7, PthXo1 and PthXo3 as references
>AvrXa7-26 (binds to Os11N3 and overlap with PthXo3 EBE)
NI HG NI NI NS HD NN HD HD HD NS N* N* HD HD NS NS NN NN NI NG NN NI N* NS N*
>PthXo3-29 (binds to Os11N3 and overlap with AvrXa7 EBE)
NI HG NI HG NI NI NI HD NN HD HD HD NG HD N* NI HD HD NN NS NI NN NN NG NN HD N* NS N*
>PthXo1-24 (binds to Os8N3)
NN HD NI HG HD NG N* HD HD NI NG NG NI HD NG NN NG NI NI NI NI N* NS N*


##--------------------------------------
## TALE-NT2 prediction of the TALEN EBE
TALE=/N/dc2/projects/brendelgroup/TRegGA/src/TALE_NT2/talesf

## AvrXa7 TALE_EBE in rice reference
# -x|--cutoffmult       multiple of best score at which potential sites will be filtered; default is 3.0. The reported sites should have their scores less than the {Best Possible Score}*{cutoff}

TEO_x=3.0

for TARGET in OsjSWEET11 OsjSWEET14
do
echo "NI HG NI NI NS HD NN HD HD HD NS N* N* HD HD NS NS NN NN NI NG NN NI N* NS N*" > TAL_avrXa7
echo "NI HG NI HG NI NI NI HD NN HD HD HD NG HD N* NI HD HD NN NS NI NN NN NG NN HD N* NS N*" > TAL_PthXo3
echo "NN HD NI HG HD NG N* HD HD NI NG NG NI HD NG NN NG NI NI NI NI N* NS N*" > TAL_PthXo1
echo "HD NG NG HD HD NG NG HD HD NG NI NN HD NI HD NG NI NG NI NG NI NI" > TALEN_L_Os11N3
echo "NN HD NG NG NN NI NI NN NN HD NG NG NN NI NG NN NI NN HD NG NG NI" > TALEN_R_Os11N3
echo "NG NI NN NI NG NI NG NN HD NI NG HD NG HD HD HD NG" > TALEN_L_Os8N3
echo "NI NG NI NG NI NN NG NG NN NN NI NN NI HD HD HD NG HD HD NI HD NG NG" > TALEN_R_Os8N3

for TALEN in TAL_avrXa7 TAL_PthXo3 TAL_PthXo1 TALEN_L_Os11N3 TALEN_R_Os11N3 TALEN_L_Os8N3 TALEN_R_Os8N3
do
talesf \
        -x ${TEO_x} \
	-o talesf.${TALEN}-${TARGET} \
	${TARGET}.fasta \
	"`cat ${TALEN}`"
done
done

##----------------------------------------------------
## Install the Paired Target Finder to find the predicted TALEN binding sites
# https://github.com/boglab/talesf/tree/paired
# add PATH to ~/.bash_profile
# Usage: ./pairedtalesf [options] sequence_file_path "rvdseq" "rvdseq2"
./pairedtalesf -o output_file genome_seq.fasta "HD NI NG NG NI HD NG NN NG NI NI NI NI N* NS N*" "N* NS N* NI NI NI NI NG NN NG HD NI NG NG NI HD"

##----------------------------------------------------
TALENP_DIR=/home/huangcy/src/TALE_NT2/talesf-paired
TPO_m=15
TPO_x=30
TPO_n=4
TPO_t=3
\rm talesf_paired.sh
for TARGET in OsjSWEET11 OsjSWEET14
do
echo '"HD NG NG HD HD NG NG HD HD NG NI NN HD NI HD NG NI NG NI NG NI NI" "NN HD NG NG NN NI NI NN NN HD NG NG NN NI NG NN NI NN HD NG NG NI"' > TALEN_LR_Os11N3
echo '"NG NI NN NI NG NI NG NN HD NI NG HD NG HD HD HD NG" "NI NG NI NG NI NN NG NG NN NN NI NN NI HD HD HD NG HD HD NI HD NG NG"' > TALEN_LR_Os8N3

for PAIREDTALEN in TALEN_LR_Os11N3 TALEN_LR_Os8N3
do
echo "
#!/usr/bin/bash
${TALENP_DIR}/pairedtalesf \
	-m ${TPO_m} \
	-x ${TPO_x} \
	-n ${TPO_n} \
	-t ${TPO_t} \
	-o talesfpaired.${PAIREDTALEN}-${TARGET} \
	${TARGET}.fasta \
	"`cat ${PAIREDTALEN}`"
" >> talesf_paired.sh
done
done

sh talesf_paired.sh

##-----------------------------------------------------
find . -name "talesfpaired.TALEN*.txt" -print -exec cat {} \; > talesfpaired-OsjSWEET.txt

## talesfpaired.TALEN_LR_Os11N3-OsjSWEET14.txt
RVD1 Best Possible Score:5.17
RVD2 Best Possible Score:11.58
Sequence Name   TAL 1   TAL 2   TAL 1 Score     TAL 2 Score     TAL 1 Start     TAL 2 Start     Spacer Length   TAL 1 Target    TAL 2\
 Target
 OsjSWEET14.0    RVD2    RVD1    17.10   5.17    3462    3524    18      T GCTTGAAGGCTTGATGAGCTTAG       T CTTCCTTCCTAGCACTATATAA
 OsjSWEET14.0    RVD2    RVD2    33.80   30.87   2182    2244    17      T ACTAGCAATGTTAATTGATAGGA       T AACTAAGATGTAGACAACCAATA
 OsjSWEET14.0    RVD2    RVD2    33.67   32.62   2769    2834    20      T GTATGTATATCTAATCTCCTCTA       T CTTTTAGAACCAAACTAAAGATA
 OsjSWEET14.0    RVD2    RVD2    29.91   34.55   3102    3175    28      T GATTAAAAATGTAGAGAATAATA       T CCAAGGAATTCTCTTGAGAATTA
 OsjSWEET14.0    RVD2    RVD2    33.44   34.53   4658    4723    20      T CATTCTAGCATTTCTCACATTCA       T GAATCTAGACATATATATCTATC
 OsjSWEET14.0    RVD2    RVD2    29.90   34.40   4723    4795    27      T CATTAAAATTAATATGAACTAGA       T TCTTTTATGAGCAATAAATAGCA


## talesfpaired.TALEN_LR_Os8N3-OsjSWEET14.txt
RVD1 Best Possible Score:4.79
RVD2 Best Possible Score:7.23
Sequence Name   TAL 1   TAL 2   TAL 1 Score     TAL 2 Score     TAL 1 Start     TAL 2 Start     Spacer Length   TAL 1 Target    TAL 2\
 Target


## talesfpaired.TALEN_LR_Os8N3-OsjSWEET11.txt
RVD1 Best Possible Score:4.79
RVD2 Best Possible Score:7.23
Sequence Name   TAL 1   TAL 2   TAL 1 Score     TAL 2 Score     TAL 1 Start     TAL 2 Start     Spacer Length   TAL 1 Target    TAL 2\
 Target
 OsjSWEET11.0    RVD2    RVD1    7.23    6.79    3822    3878    17      T ATATAGTTGGAGACCCTCCACTT       T TAGATATGCATCTCCCC


## talesfpaired.TALEN_LR_Os11N3-OsjSWEET11.txt
RVD1 Best Possible Score:5.17
RVD2 Best Possible Score:11.58
Sequence Name   TAL 1   TAL 2   TAL 1 Score     TAL 2 Score     TAL 1 Start     TAL 2 Start     Spacer Length   TAL 1 Target    TAL 2\
 Target
 OsjSWEET11.0    RVD2    RVD2    33.28   34.59   1136    1196    15      T CACTCAAAGCTGACTGACTGACT       T ACTTAAATTAATTATCTTGTTCA
 OsjSWEET11.0    RVD2    RVD2    32.72   33.41   2360    2427    22      T TCTTGTACACCTGCAAGAACGTC       T CTCTGACGACGAACTGGAATTTA
 OsjSWEET11.0    RVD2    RVD2    32.28   33.39   4487    4559    27      T GTTCAAAAGAGAGAAAAAAAAGA       T GGTACAACAGATGCTGATACAAA
 OsjSWEET11.0    RVD2    RVD2    32.08   33.71   4753    4816    18      T GCTTGTTAGATCGATCTTAATTA       T CCATAACTTCAGGAAAAGGTGAA
 

##-----------------------------------------------------
find . -name "talesfpaired.TALEN*.gff3" -print -exec cat {} \; > talesfpaired-OsjSWEET.gff3

